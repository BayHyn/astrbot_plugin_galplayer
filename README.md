
# 🎮 AstrBot Galgame 同乐插件

你是否曾想过和群友们一起在聊天群里玩 Galgame 或视觉小说？这个插件将这个想法变为了现实！

本插件能够捕捉你电脑上指定的游戏窗口画面，通过截图的方式实时“直播”到聊天群里。群里的每一个人都可以通过简单的指令来控制游戏（例如推进对话、进行选择），实现云玩 Galgame 的有趣体验。

<span style="color: red; font-size: 2em;">小心hcg</span>

## ✨ 主要功能

*   **实时游戏画面分享**：将指定窗口的画面以图片形式发送到群聊。
*   **多人协作控制**：群内的任何人都可以发送指令来推进游戏。
*   **完整的键盘模拟**：支持模拟几乎所有键盘按键，包括方向键、回车、空格、字母和数字，甚至支持中文别名（如“上”、“空格”）。
*   **两种输入模式**：
    *   **`SendInput` (前台高兼容模式)**：兼容性最强的模式，可以操作绝大多数“顽固”的游戏，但**需要将游戏窗口置于最前台**。
    *   **`PostMessage` (后台模式)**：可以在游戏窗口**不处于最上层**的情况下进行截图和按键，不打扰你正常使用电脑，但好像不怎么能用。

## ⚙️ 安装

1.  将整个 `astrbot_plugin_galplayer` 文件夹放入你的 AstrBot 的 `data/plugins` 目录中。
2.  启动或重启 AstrBot。
3.  进入 AstrBot 的 WebUI，在“插件管理”页面，找到本插件并确保它已启用。
4.  AstrBot 会自动检测 `requirements.txt` 文件并为你安装所需的依赖库 (`pygetwindow`, `pywin32`, `Pillow`)。

## 🚀 使用方法

### 1. 启动游戏

在你的电脑上打开你想要和朋友一起玩的 Galgame。

### 2. 获取窗口标题

仔细查看游戏窗口最上方的标题栏，记下标题的一部分或者全部。例如：`Doki Doki Literature Club Plus`只用记住Doki。

### 3. 开始游戏

在群聊中，发送开始指令，并将你记下的标题作为参数。

```
/gal start Doki
```

机器人会找到该窗口，发送第一张截图，游戏正式开始！

### 4. 控制游戏

以下是所有可用的指令：

| 指令 / 消息 | 别名 | 功能 |
| :--- | :--- | :--- |
| `g` 或 `gal` | 无 | **最常用的指令**。发送后会模拟按下配置文件中指定的“快捷推进键”（默认为`space`），然后发送新截图。 |
| `/gal start <窗口标题>` | `/gal 开始游戏` | 开始一场新游戏。 |
| `/gal stop` | `/gal 停止游戏` | 结束当前正在进行的游戏。 |
| `/gal type <按键名>` | `/gal 输` | 模拟输入一个指定的按键。支持中文和英文。<br>**示例**: `/gal type enter`, `/gal type a`, `/gal type 上`, `/gal type 空格` |
| `/gal resend` | `/gal 重发` | 不执行任何按键，仅重新截取并发送一次当前的游戏画面。用于画面更新延迟的场景。 |
| `/gal help` | `/gal 帮助` | 在聊天中显示此帮助信息。 |

## 🔧 配置

你可以在 AstrBot WebUI 的“插件管理”页面，点击本插件的“管理”按钮，来修改以下配置：

| 配置项 | 类型 | 默认值 | 描述 |
| :--- | :--- | :--- | :--- |
| **`input_method`** | `下拉选择` | `SendInput` | **最重要的配置！** 选择按键的输入模式。<br>- **`PostMessage`**: 后台模式，兼容大部分游戏，不影响电脑使用。<br>- **`SendInput`**: 前台模式，兼容性最强，但游戏窗口必须是当前活动窗口。 |
| `cooldown_seconds` | `浮点数` | `3.0` | 两次指令之间的最小时间间隔（秒），用于防止刷屏。 |
| `screenshot_delay_seconds`| `浮点数` | `0.5` | 按键后等待多久再截图（秒）。如果游戏动画较慢，可以适当调高此值。 |
| `quick_advance_key` | `字符串` | `space` | 设置 `g` 或 `gal` 这条快捷指令所对应的键盘按键。 |

## ❓ 疑难解答 (FAQ)

**Q: 我对一个游戏使用了所有指令，但它就是没反应！**
**A:** 这是最常见的问题！请进入插件配置页面，将 **`Input Method`** 从 `PostMessage` **切换到 `SendInput`**，保存后重试。这能解决绝大多数游戏的兼容性问题，但代价是游戏窗口必须保持在前台。

**Q: 机器人提示“找不到窗口”。**
**A:** 请确保：1. 游戏已经打开。2. 你在 `/gal start` 指令后输入的窗口标题和游戏窗口上显示的**完全一致**，包括所有空格和符号。

**Q: 为什么在使用 `SendInput` 模式时，游戏窗口总会跳到最前面？**
**A:** 这是 `SendInput` 模式的正常行为。它模拟的是真实的物理键盘输入，而物理键盘只能对当前激活的窗口进行操作。

**Q: 游戏可以最小化吗？**

**A:** 不可以。游戏窗口必须处于打开状态（但可以使用 `PostMessage` 模式让它被其他窗口遮挡）。

